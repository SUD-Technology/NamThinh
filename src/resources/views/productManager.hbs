{{!-- Body: start --}}
<div class="container">
    <div class="product-manager-body">
        <form action="/admin/product-manager/" class="find-product-form">
            <div class="form-group">
                <div class="row m-0">
                    <div class="col-md-6 mb-2">
                        <input value="{{product_name}}" type="text" placeholder="Tên sản phẩm" name="product_name"
                            class="form-control">
                    </div>
                    <div class="col-md-2 mb-2">
                        {{#select lv1}}
                        <select name="lv1" class="form-control" id="product-lv1">
                            <option value="">-- Loại sản phẩm --</option>
                            <option value="1">LỐP ADVANCE/SAMSON</option>
                            <option value="2">XE TẢI/ ĐẦU KÉO / XE BEN</option>
                            <option value="3">PHỤ TÙNG Ô TÔ</option>
                            <option value="4">DẦU NHỚT</option>
                        </select>
                        {{/select}}
                    </div>
                    <div class="col-md-2 mb-2">
                        <select name="lv2" class="form-control" id="product-lv2">
                        </select>
                    </div>
                    <div class="col-md-2 mb-2">
                        <select name="lv3" class="form-control" id="product-lv3">
                        </select>
                    </div>
                    <div class="col-md-2 mb-2">
                        {{#select origin}}
                        <select name="origin" class="form-control" id="exampleFormControlSelect1">
                            <option value="">Xuất xứ</option>
                            {{#each origins}}
                            <option value="{{this}}">{{this}}</option>
                            {{/each}}
                        </select>
                        {{/select}}
                    </div>
                    <div class="col-md-2 mb-2">
                        {{#select brand}}
                        <select name="brand" class="form-control" id="exampleFormControlSelect1">
                            <option value="">Thương hiệu</option>
                            {{#each brands}}
                            <option value="{{this}}">{{this}}</option>
                            {{/each}}
                        </select>
                        {{/select}}
                    </div>
                    <div class="col-md-2 mb-2">
                        <a type="button"
                            onclick='window.location.href="/admin/product-manager/?product_name=&lv1=&origin=&brand="'
                            class="form-control text-center"><i class="fas fa-undo"></i>Tạo lại</a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="form-control btn btn-success">Tìm kiếm</button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button type="button" data-toggle="modal" data-target=".cart-modal" id="admin-cart"
                            class="form-control btn btn-info">Giỏ hàng <span id="admin-np"
                                class="badge badge-light"></span></button>
                    </div>
                </div>
            </div>
        </form>
        {{!-- Modal: start --}}
        <div class="modal fade cart-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <section class="shopping-cart dark">
                        <div class="container">
                            <div class="block-heading">
                                <h2>Giỏ Hàng</h2>
                            </div>
                            <div class="content">
                                <div class="row">
                                    <div class="col-md-12 col-lg-8">
                                        <div id="cart-products" class="items">

                                        </div>
                                    </div>
                                    <div class="col-md-12 col-lg-4">
                                        <div class="summary">
                                            <h3>Tổng giá</h3>
                                            <div id="subtotal" class="summary-item"></div>
                                            <div class="summary-item"><span class="text">Khuyến
                                                    mãi</span><span id="discount-price" class="price"></span></div>
                                            <div id="total-price" class="summary-item"></div>
                                            <button type="button" onclick="createOrder()" id="create-order"
                                                class="btn btn-success">Tạo đơn
                                                hàng</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
        {{!-- Modal: end --}}

        <div class="row m-0">
            <div class="col-md-4">
                <nav aria-label="Page navigation example">
                    <ul class="pagination">
                        {{!-- Previous Page: start --}}
                        {{#if (isFirstPage current)}}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                                <span class="sr-only">Previous</span>
                            </a>
                        </li>
                        {{else}}
                        <li class="page-item">
                            <a class="page-link"
                                href="/admin/product-manager/?page={{previous}}?lv1={{lv1}}&lv2={{lv2}}&lv3={{lv3}}&brand={{brand}}&origin={{origin}}&product_name={{product_name}}"
                                aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                                <span class="sr-only">Previous</span>
                            </a>
                        </li>
                        {{/if}}
                        {{!-- Item: start --}}
                        {{#pagination current pages lv1=lv1 lv2=lv2 lv3=lv3 brand=brand origin=origin
                        product_name=product_name}}
                        {{/pagination}}
                        {{!-- Next Page: start --}}
                        {{#if (isLastPage current pages)}}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                                <span class="sr-only">Next</span>
                            </a>
                        </li>
                        {{else}}
                        <li class="page-item">
                            <a class="page-link"
                                href="/admin/product-manager/?page={{next}}?lv1={{lv1}}&lv2={{lv2}}&lv3={{lv3}}&brand={{brand}}&origin={{origin}}&product_name={{product_name}}"
                                aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                                <span class="sr-only">Next</span>
                            </a>
                        </li>
                        {{/if}}
                    </ul>
                </nav>
            </div>
            <div id="alertAddToCart" class="col-md-8">

            </div>
        </div>

        <table class="table table-hover table-bordered table-product">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Ảnh</th>
                    <th scope="col">Tên hàng hóa</th>
                    <th scope="col">Mã</th>
                    <th scope="col">Giá</th>
                    <th scope="col">Nhập</th>
                    <th scope="col">Tồn</th>
                    <th scope="col"></th>
                    {{#isAccountant position}}
                    <th scope="col">Sửa</th>
                    <th scope="col">Xóa</th>
                    {{/isAccountant}}
                </tr>
            </thead><br>
            <tbody>
                {{#if products}}
                {{#each products}}
                <tr>
                    <th scope="row">{{inc @index}}</th>
                    <td>
                        {{#if pimg}}
                        <img src="{{pimg}}" alt="">
                        {{/if}}
                    </td>
                    <td><a target="_blank" href="/products/{{pslug}}">{{pname}}</a></td>
                    <td>{{pid}}</td>
                    <td>{{price}}</td>
                    <td>{{amount}}</td>
                    <td>{{inventory}}</td>
                    <td>
                        <!-- Button trigger modal -->
                        Thêm vào giỏ
                        <button type="button" class="btn btn-info"
                            onclick="addToCart(`{{pid}}`, `{{pname}}`, `{{numPrice}}`, `{{pimg}}`, `{{inventory}}`, `{{model}}`)">
                            <i class="fas fa-plus"></i>
                        </button>
                    </td>
                    {{#isAccountant position}}
                    <td id="edit-product">
                        <!-- Button trigger modal -->
                        <a type="button" class="btn btn-warning w-100" href="/admin/updateProduct/{{id}}">
                            <i class="fas fa-edit"></i>
                        </a>
                    </td>
                    <td id="delete-product"><a href="/admin/delete/{{pid}}" style="color: white"
                            class="w-100 btn btn-danger">Xóa</a></td>
                    {{/isAccountant}}
                </tr>
                {{/each}}
                {{else}}
                <tr>
                    <td colspan="7">Không tìm thấy sản phẩm</td>
                </tr>
                {{/if}}
            </tbody>
        </table>
        <div class="row m-0">
            <div class="col-md-4">
                <ul class="pagination">
                    {{!-- Previous Page: start --}}
                    {{#if (isFirstPage current)}}
                    <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    {{else}}
                    <li class="page-item">
                        <a class="page-link"
                            href="/admin/product-manager/?page={{previous}}?lv1={{lv1}}&lv2={{lv2}}&lv3={{lv3}}&brand={{brand}}&origin={{origin}}&product_name={{product_name}}"
                            aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    {{/if}}
                    {{!-- Item: start --}}
                    {{#pagination current pages lv1=lv1 lv2=lv2 lv3=lv3 brand=brand origin=origin
                    product_name=product_name}}
                    {{/pagination}}
                    {{!-- Next Page: start --}}
                    {{#if (isLastPage current pages)}}
                    <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                    {{else}}
                    <li class="page-item">
                        <a class="page-link"
                            href="/admin/product-manager/?page={{next}}?lv1={{lv1}}&lv2={{lv2}}&lv3={{lv3}}&brand={{brand}}&origin={{origin}}&product_name={{product_name}}"
                            aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                    {{/if}}
                </ul>
            </div>
        </div>

    </div>



</div>
{{!-- Body: end --}}

<script>


    //
    var urlParams = new URLSearchParams(window.location.search);
    $('#product-lv1').change(function () {
        var $option = $(this).find('option:selected')
        if ($option.val() == '') {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
            $('#product-lv3').empty()
            $('#product-lv3').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
        } else if ($option.val() == 1) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Lốp xe tải - xe khách`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Lốp công trình`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Lốp công nghiệp`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Lốp nông nghiệp`).attr('value', `4`))
        } else if ($option.val() == 2) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại xe --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Xe tải thùng`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Xe Đầu kéo`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Xe ben`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Sơ mi rơ móc`).attr('value', `4`))
        } else if ($option.val() == 3) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại phụ tùng --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Xe tải thùng`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Xe Đầu kéo`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Xe ben`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Sơ mi rơ móc`).attr('value', `4`))
        } else if ($option.val() == 4) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Dầu nhớt ô tô / xe máy`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Dầu nhớt công nghiệp`).attr('value', `2`))
        }
    });
    var select_lv1 = $('#product-lv1').find('option:selected')
    if (select_lv1.val()) {
        let lv2 = urlParams.get('lv2') || ''
        if (select_lv1.val() == '') {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
            $('#product-lv3').empty()
            $('#product-lv3').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
        } else if (select_lv1.val() == 1) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Lốp xe tải - xe khách`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Lốp công trình`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Lốp công nghiệp`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Lốp nông nghiệp`).attr('value', `4`))
        } else if (select_lv1.val() == 2) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại xe --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Xe tải thùng`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Xe Đầu kéo`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Xe ben`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Sơ mi rơ móc`).attr('value', `4`))
        } else if (select_lv1.val() == 3) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại phụ tùng --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Xe tải thùng`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Xe Đầu kéo`).attr('value', `2`))
            $('#product-lv2').append($('<option></option>').text(`Xe ben`).attr('value', `3`))
            $('#product-lv2').append($('<option></option>').text(`Sơ mi rơ móc`).attr('value', `4`))
        } else if (select_lv1.val() == 4) {
            $('#product-lv2').empty()
            $('#product-lv2').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
            $('#product-lv2').append($('<option></option>').text(`Dầu nhớt ô tô / xe máy`).attr('value', `1`))
            $('#product-lv2').append($('<option></option>').text(`Dầu nhớt công nghiệp`).attr('value', `2`))
        }
        $(`select[name=lv2] option[value=${lv2}]`).attr('selected', 'selected')
    }


    $('#product-lv2').change(function () {
        var $option = $(this).find('option:selected')
        var level1 = $('#product-lv1').find('option:selected').val()

        if ($option.val() == '') {
            $('#product-lv3').empty()
            $('#product-lv3').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
        } else if (level1 == 1) {
            if ($option.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
            }
            if ($option.val() == 1) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp tải nhẹ`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp tải nặng`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe khách - xe bus`).attr('value', `3`))
            } else if ($option.val() == 2) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe tải hạng nặng`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp máy xúc`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe cẩu`).attr('value', `3`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe lu`).attr('value', `4`))
            }
            else if ($option.val() == 3) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp đặc`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp công nghiệp khí nén`).attr('value', `2`))
            } else if ($option.val() == 4) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp nông nghiệp nhỏ`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp nông nghiệp lớn`).attr('value', `2`))
            }
        } else if (level1 == 2) {
            if ($option.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại xe --`).attr('value', ``))
            }
        } else if (level1 == 3) {
            if ($option.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại phụ tùng --`).attr('value', ``))
            }
        } else if (level1 == 4) {
            if ($option.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
            } else if ($option.val() == 1) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Dầu động cơ`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Dầu hợp số`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Dầu láp`).attr('value', `3`))
            } else if ($option.val() == 2) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Dầu đa năng`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Dầu bôi trơn`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Dầu thủy lực`).attr('value', `3`))
            }
        }
    })
    var select_lv2 = $('#product-lv2').find('option:selected')
    if (select_lv2.val()) {
        let lv3 = urlParams.get('lv3') || ''
        if (select_lv2.val() == '') {
            $('#product-lv3').empty()
            $('#product-lv3').append($('<option></option>').text(`-- Chọn danh mục sản phẩm --`).attr('value', ``))
        } else if (select_lv1.val() == 1) {
            if (select_lv2.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
            }
            if (select_lv2.val() == 1) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe tải hạng nặng`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe máy xúc`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe cẩu`).attr('value', `3`))
                $('#product-lv3').append($('<option></option>').text(`Lốp xe lu`).attr('value', `4`))
            } else if (select_lv2.val() == 2) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp đặc`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp công nghiệp khí nén`).attr('value', `2`))
            } else if (select_lv2.val() == 3) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại lốp --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Lốp nông nghiệp nhỏ`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Lốp nông nghiệp lớn`).attr('value', `2`))
            }
        } else if (select_lv1.val() == 2) {
            if (select_lv2.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại xe --`).attr('value', ``))
            }
        } else if (select_lv1.val() == 3) {
            if (select_lv2.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại phụ tùng --`).attr('value', ``))
            }
        } else if (select_lv1.val() == 4) {
            if (select_lv2.val() == 0) {
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
            } else if (select_lv2.val() == 1) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Dầu động cơ`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Dầu hợp số`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Dầu láp`).attr('value', `3`))
            } else if (select_lv2.val() == 2) {
                $('#product-lv3').empty()
                $('#product-lv3').append($('<option></option>').text(`-- Chọn loại dầu nhớt --`).attr('value', ``))
                $('#product-lv3').append($('<option></option>').text(`Dầu đa năng`).attr('value', `1`))
                $('#product-lv3').append($('<option></option>').text(`Dầu bôi trơn`).attr('value', `2`))
                $('#product-lv3').append($('<option></option>').text(`Dầu thủy lực`).attr('value', `3`))
            }
        }
        $(`select[name=lv3] option[value=${lv3}]`).attr('selected', 'selected')
    }


    // Add product to cart: admin -- start
    const cartItemsEl = document.getElementById('cart-products')
    const totalPrice = document.getElementById('total-price')
    let cart
    if (localStorage.getItem('admin-cart')) {
        cart = JSON.parse(localStorage.getItem('admin-cart'))
        renderCartItem()
        renderSubtotal()
    }
    else
        cart = JSON.parse(localStorage.setItem('admin-cart', '[]'))
    if (cart.length > 0) {
        console.log('cart have items')
    }
    
    function addToCart(id, name, price, img, inventory, model) {
        let checkId = cart.some(item => {
            item = JSON.parse(item)
            return item.id === id
        })
        if (checkId) {
            changeNumberOfUnitAdmin('plus', id)
            alertAddToAdminCart(name)
        } else if (inventory != 0) {
            const product = {
                id: id,
                name: name,
                price: price,
                stringPrice: Number(price).toLocaleString('vi', { style: 'currency', currency: 'VND' }),
                img: img,
                inventory: inventory,
                model: model
            }
            cart.push(JSON.stringify({
                ...product,
                numberOfUnit: 1
            }))
            alertAddToAdminCart(name)
        }
        updateCart()
    }

    // alert message add product
    function alertAddToAdminCart(name) {
        document.getElementById('alertAddToCart').innerHTML =
            `<div class="alert alert-success alert-dismissible fade show" role="alert">
                    Đã thêm <strong>${name}</strong> vào giỏ hàng
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>`
    }

    function updateCart() {
        renderCartItem()
        renderSubtotal()
        updateLocalStorage()
    }



    // render cart items

    function updateLocalStorage() {
        localStorage.setItem('admin-cart', JSON.stringify(cart))
    }
    function renderCartItem() {
        cartItemsEl.innerHTML = ``;
        cart.forEach(item => {
            item = JSON.parse(item)
            cartItemsEl.innerHTML += `<div class="product">
                                                <div class="row">
                                                    <div class="col-md-3 mt-auto mb-auto">
                                                        <img class="img-fluid mx-auto d-block image"
                                                            src="${item.img}">
                                                    </div>
                                                    <div class="col-md-8">
                                                        <div class="info">
                                                            <div class="row">
                                                                <div class="col-md-5 product-name">
                                                                    <div class="product-name">
                                                                        <a href="#">${item.name}</a>
                                                                        <div class="product-info">
                                                                            <div>Model: <span class="value">${item.model}</span></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4 quantity">
                                                                    <label for="${item.id}">Số lượng:</label>
                                                                    <input class="form-control quantity-input d-none">
                                                                    <div class="units">
                                                                        <div class="btn minus" onclick="changeNumberOfUnitAdmin('minus', '${item.id}')">-</div>
                                                                        <div class="number">${item.numberOfUnit}</div>
                                                                        <div class="btn plus" onclick="changeNumberOfUnitAdmin('plus', '${item.id}')">+</div>           
                                                                    </div>
                                                                    
                                                                </div>
                                                                <div class="col-md-3 price">
                                                                    <span>${item.stringPrice}</span>
                                                                </div>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-1 mt-auto mb-auto">
                                                        <button style="border: 0; color: red;" class="" onclick="deleteItem('${item.id}')"><i class="fas fa-trash"></i></button>
                                                    </div>
                                                </div>
                                            </div>`
        })
    }
    function renderSubtotal() {
        let total = 0, totalItems = 0;
        cart.forEach(item => {
            item = JSON.parse(item)
            total += Number(item.price) * item.numberOfUnit;
            totalItems += item.numberOfUnit;
        })
        total = total.toLocaleString('vi', { style: 'currency', currency: 'VND' });
        totalPrice.innerHTML = `<span class="text">Tổng</span><span class="price">${total}</span>`
        document.getElementById('subtotal').innerHTML = `<span class="text">Tạm tính</span><span  class="price">${total}</span>`
    }
    // Change input

    function increaseCount(a, b) {
        let input = b.previousElementSibling;
        let value = parseInt(input.value, 10);
        value = isNaN(value) ? 0 : value;
        let pid = input.id
        let product = cart.find(({ id }) => id === pid)
        if (value < product.inventory) {
            value++;
            cart = cart.map(item => {
                let numberOfUnit = item.numberOfUnit
                if (item.id = product.id) {
                    return {
                        ...item,
                        numberOfUnit: value
                    }
                }
            })
        }
        input.value = value;
        updateCart()

    }

    // delete item
    function deleteItem(id) {
        //cart = cart.filter(item => item.id != id)
        cart = cart.filter(item => {
            item = JSON.parse(item)
            return item.id != id
        })
        updateCart()
    }


    // Change number of unit
    function changeNumberOfUnitAdmin(action, id) {
        cart = cart.map(item => {
            item = JSON.parse(item)
            let numberOfUnit = item.numberOfUnit
            if (item.id === id) {
                if (action == 'minus' && numberOfUnit > 1) {
                    numberOfUnit--
                } else if (action == 'plus' && numberOfUnit < item.inventory) {
                    numberOfUnit++
                }
            }
            return JSON.stringify({
                ...item,
                numberOfUnit: numberOfUnit
            })
        })
        updateCart()
    }
    // Add product to cart: admin -- end

    // Create order
    function createOrder() {
        location.href = "/admin/create-order"
    }

</script>